<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{fragments/video_layout :: layout(${file.name}, ~{::div.grid-container})}">
    <body>

        <div class="grid-container grid grid-cols-1 lg:grid-cols-4 gap-8 p-5">

            <div class="lg:col-span-3 flex flex-col gap-6">

                <div class="relative group w-full bg-black rounded-xl overflow-hidden shadow-2xl shadow-black/50 ring-1 ring-white/10">
                    <video id="mainPlayer" class="w-full aspect-video object-contain" controls autoplay>
                        <source th:src="@{/api/media/stream/{id}(id=${file.id})}" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                </div>

                <div class="flex flex-col gap-4">
                    <h1 class="text-white text-2xl md:text-3xl lg:text-[2rem] font-bold leading-tight tracking-tight" 
                        th:text="${file.name}">Video Title</h1>

                    <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 border-b border-white/5 pb-4">
                        <div class="flex items-center gap-4">
                            <a th:href="@{/subjects/{id}(id=${subject?.id})}" class="relative cursor-pointer hover:opacity-80 transition-opacity">
                                <div class="size-12 rounded-full bg-cover bg-center ring-2 ring-primary/20 bg-gray-700 overflow-hidden">
                                    <img th:if="${subject != null && subject.avatarUrl != null}" th:src="${subject.avatarUrl}" class="w-full h-full object-cover">
                                    <div th:unless="${subject != null && subject.avatarUrl != null}" class="w-full h-full flex items-center justify-center text-white font-bold bg-gradient-to-tr from-primary to-purple-600">
                                        <span th:text="${subject != null ? #strings.substring(subject.mainName,0,1) : '?'}">A</span>
                                    </div>
                                </div>
                            </a>

                            <div class="flex flex-col">
                                <div class="flex items-center gap-2">
                                    <a th:href="@{/subjects/{id}(id=${subject?.id})}" 
                                       class="text-white text-lg font-bold hover:text-primary transition-colors" 
                                       th:text="${subject != null ? subject.mainName : 'Unknown Subject'}">Subject Name</a>
                                    <span class="material-symbols-outlined text-[16px] text-blue-400" title="Verified">verified</span>
                                </div>
                                <span class="text-gray-400 text-sm" 
                                      th:text="${subject != null && subject.aliasName1 != null ? subject.aliasName1 : 'No alias'}">Alias</span>
                            </div>

                            <button class="ml-2 px-6 py-2 bg-primary hover:bg-primary/90 text-white text-sm font-bold rounded-full transition-colors shadow-lg shadow-primary/20">
                                Follow
                            </button>
                        </div>

                        <div class="flex items-center gap-2 self-start sm:self-auto">
                            <button class="flex items-center gap-2 h-10 px-4 bg-surface-dark hover:bg-surface-dark-hover rounded-full text-white text-sm font-medium transition-colors border border-white/5">
                                <span class="material-symbols-outlined text-[20px]">thumb_up</span>
                                <span>Like</span>
                            </button>
                            <button class="flex items-center justify-center size-10 bg-surface-dark hover:bg-surface-dark-hover rounded-full text-white transition-colors border border-white/5" title="Share">
                                <span class="material-symbols-outlined text-[20px]">share</span>
                            </button>
                        </div>
                    </div>

                    <div class="bg-surface-dark rounded-xl p-4 transition-colors group border border-white/5">
                        <div class="flex gap-2 text-sm font-bold text-white mb-2">
                            <span th:text="${file.readableSize}">Size</span>
                            <span>•</span>
                            <span th:text="${#temporals.format(file.createdAt, 'dd MMM yyyy')}">Date</span>
                            <span th:if="${file.durationFormatted}">•</span>
                            <span th:if="${file.durationFormatted}" th:text="${file.durationFormatted}">Duration</span>
                        </div>
                        <p class="text-gray-300 text-sm leading-relaxed whitespace-pre-line" 
                           th:text="${subject != null ? subject.description : 'No description available for this content.'}"></p>
                    </div>

                    <div class="mt-4">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-white text-lg font-bold">Comments</h3>
                        </div>
                        <div class="flex gap-4 mb-6">
                            <div class="size-10 rounded-full bg-gray-700 shrink-0 flex items-center justify-center text-white text-xs">You</div>
                            <div class="flex-1">
                                <input class="w-full bg-transparent border-0 border-b border-white/10 focus:border-primary focus:ring-0 px-0 py-2 text-white placeholder:text-gray-500 transition-colors" placeholder="Add a comment..." type="text"/>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-1 flex flex-col gap-6 relative">

                <div class="sticky top-20 z-10 -mx-4 px-4 md:mx-0 md:px-0 bg-background-dark/95 backdrop-blur py-2 border-b border-white/5 lg:border-none">
                    <div class="flex gap-2 overflow-x-auto hide-scrollbar pb-2">
                        <button class="whitespace-nowrap px-3 py-1.5 bg-white text-black text-sm font-bold rounded-lg transition-colors">All</button>
                        <button class="whitespace-nowrap px-3 py-1.5 bg-surface-dark hover:bg-surface-dark-hover border border-white/5 text-gray-300 hover:text-white text-sm font-medium rounded-lg transition-colors">Related</button>
                    </div>
                </div>

                <div class="flex items-center justify-between text-white">
                    <h3 class="font-bold text-lg" th:text="${subject != null ? 'More from ' + subject.mainName : 'Recommendations'}">Recommendations</h3>
                </div>

                <div class="flex flex-col gap-4">
                    <a th:each="rec : ${recommendations}" 
                       th:href="@{/video/{id}(id=${rec.id})}" 
                       class="flex gap-3 group cursor-pointer hover:bg-surface-dark p-2 -ml-2 rounded-xl transition-colors">

                        <div class="relative w-40 aspect-video rounded-lg overflow-hidden shrink-0 bg-black ring-1 ring-white/10">
                            <img th:src="@{/api/media/thumbnail/{id}(id=${rec.id})}" 
                                 class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                                 onerror="this.src='https://placehold.co/160x90/1e1e1e/FFF?text=No+Thumb'">

                            <div th:if="${rec.durationFormatted}" 
                                 class="absolute bottom-1 right-1 bg-black/80 px-1.5 py-0.5 rounded text-[10px] font-bold text-white shadow-sm">
                                <span th:text="${rec.durationFormatted}">00:00</span>
                            </div>
                        </div>

                        <div class="flex flex-col py-1 min-w-0 justify-between">
                            <div>
                                <h4 class="text-white text-sm font-bold leading-tight mb-1 group-hover:text-primary transition-colors line-clamp-2" 
                                    th:text="${rec.name}">Video Name</h4>
                                <div class="text-xs text-gray-400 truncate" th:text="${subject != null ? subject.mainName : 'Unknown'}">Artist</div>
                            </div>
                            <div class="text-xs text-gray-500" th:text="${rec.readableSize}">Size</div>
                        </div>
                    </a>

                    <div th:if="${recommendations.isEmpty()}" class="text-gray-500 text-center py-8 text-sm">
                        No related videos found.
                    </div>
                </div>

                <div class="bg-gradient-to-br from-primary/20 to-surface-dark border border-primary/10 rounded-xl p-4 mt-4">
                    <div class="flex items-start gap-3">
                        <span class="material-symbols-outlined text-primary text-[32px]">cloud_upload</span>
                        <div>
                            <h4 class="text-white font-bold text-sm">Backup your memories</h4>
                            <p class="text-gray-400 text-xs mt-1">Your MediaVault is secure.</p>
                            <button class="mt-3 text-xs font-bold text-white bg-primary hover:bg-primary/80 px-3 py-1.5 rounded-lg transition-colors">Manage Storage</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>